# 基本設計(Basic Design)

- [基本設計(Basic Design)](#基本設計basic-design)
  - [FE](#fe)
    - [ノード参照画面](#ノード参照画面)
  - [CMS](#cms)
    - [認証・認可](#認証認可)
    - [ノード管理共通](#ノード管理共通)
    - [汎用一覧画面](#汎用一覧画面)
    - [キャリアシート管理](#キャリアシート管理)
    - [プロフィール管理](#プロフィール管理)
  - [API](#api)

## FE

### ノード参照画面

- ヘッダー部
  - パス指定
- ボディ部
  - コンテンツ表示(キャリアシート、プロフィールで別個のデザイン)
  - プロフィールの場合、md→html変換して表示

## CMS

- 参照可能ノードの項目チェック定義はyamlに表現する
  - Yamlファイルを使用した項目チェックについて.md参照(TODO:md参照)
- 項目名と論理名のマッピングもyamlに表現する

### 認証・認可

- 管理ユーザを定義する
- 管理ユーザで認証・認可できるようにする(TODO: 後ほど検討)

### ノード管理共通

- 画面
  - 一覧画面
    - ページノード新規登録ボタン
    - ノード一覧
      - ノードフォーマット名
      - 参照可能ノード(参照可能ノードとその子ノードのであることを識別可能とする)
      - キー({ページノードキー}-{親ノードキー..}-{ノードキー})
      - 値
        - BLOBフラグ=ON
          - BLOBラベル表示(TODO:Phase2ではBLOBボタンとしDL可能とするか検討)
        - BLOBフラグ=OFF
          - 当該ノードの値を表示
      - 登録ボタン
        - 登録画面を表示
        - 他、RD.md参照
      - 更新ボタン
        - 編集画面を表示
        - 他、RD.md参照
      - 削除ボタン
        - 削除確認ダイアログを表示
        - 他、RD.md参照
  - 詳細画面
    - ページノードID
    - 当該ノードID
    - キー({ノードキー})
    - 値
      - BLOBフラグ=ON
        - BLOBラベル表示(TODO:Phase2ではBLOBボタンとしDL可能とするか検討)
      - BLOBフラグ=OFF
        - 当該ノードの値を表示
  - 登録画面
    - 登録ボタン押下時、確認ダイアログを表示する
      - OKボタン押下時は登録処理を実施
    - ページノードID
      - ページノード登録時、未指定
      - ページノード以外(子ノード)の場合、遷移元画面よりページノードID引継
    - 親ノードID
      - 必ず遷移元画面より引継
      - ページノード登録の場合、ルートノードIDを指定
    - キー({ノードキー})
    - 値
      - BLOBフラグ=ON
        - ULコンポーネント表示
      - BLOBフラグ=OFF
        - 当該ノードの値を表示
  - 編集画面
    - 更新ボタン押下時、確認ダイアログを表示する
      - OKボタン押下時は更新処理を実施
    - ページノードID
      - 必ず遷移元画面より引継
    - 当該ノードID
      - 必ず遷移元画面より引継
    - キー({ノードキー})
    - 値
      - BLOBフラグ=ON
        - BLOBラベル表示(TODO:Phase2ではBLOBボタンとしDL可能とするか検討)
        - ULコンポーネント表示
      - BLOBフラグ=OFF
        - 当該ノードの値を表示
  - 削除確認ダイアログ
    - 子ノードが存在チェックを実施(削除APIにて実施想定)
      - 子ノードが存在する場合
        - 子ノードも含めて削除する旨を確認
          - OKボタン押下時は削除処理を実施(子ノード含めて再帰的削除(再帰的削除フラグ = ON))
      - 子ノードが存在しない場合
        - OKボタン押下時は削除処理を実施

### 汎用一覧画面

- TODO もしかしたらキャリアシートとプロフィール画面も実装としてはまとめられるかも(NodeFormatによる制御機能の充実度による)

### キャリアシート管理

- 画面(ノード管理共通-画面参照)

### プロフィール管理

- mdファイルをアップロードしDB管理する
- 画面(ノード管理共通-画面参照)
  
## API

IFは以下に定義する

- FE API
  - 詳細はapi_for_fe.yaml参照
  - 以下 概要
    - TODO (検討中)

- CMS API
  - 詳細はapi_for_cms.yaml参照
  - 以下 概要
    - ノードフォーマット取得(get nodeformat)
      - 画面制御用
    - ノード一覧取得(get node list)
      - ページノード一覧を取得(ノードフォーマットを跨いで)
      - パラメータを指定することでページノードの全子ノードも取得できる
    - ノード取得(get node)
      - 当該ノードの詳細情報取得
    - ノード登録(post node)
      - ノード登録
      - 参照可能ノード判定あり
      - パラメータ
        - 親ノードID(ページノードと同じ場合あり)
          - 必須
          - 直親ノードIDを指定(必ずしもページノードIDとはならない)
          - ページノードの場合、ルートノードID=0を指定
        - ページノードID
          - 任意
          - 自身がページノードの場合指定なし
    - ノード更新(put node)
      - 指定ノード更新
      - 参照可能ノード判定あり
      - 当該ノードが存在しない場合、登録処理をする(TODO:PUTを意識した仕様だが、当面なくてもよい)
      - パラメータ
        - ページノードID
          - 必須
          - 直親ノードIDは指定不要
        - 当該ノードID
          - 必須
    - ノード削除(delete node)
      - 指定ノード削除
      - 再帰的削除フラグ = OFFの場合
        - 子ノードが存在する場合削除不可
      - 再帰的削除フラグ = ONの場合
        - 子ノードごと削除可とする
      - 参照可能ノード判定あり
      - パラメータ
        - ページノードID
          - 必須
          - 直親ノードIDは指定不要
        - 当該ノードID
          - 必須
        - 再帰的削除フラグ
          - 子ノードも含めて削除を許可するフラグ
